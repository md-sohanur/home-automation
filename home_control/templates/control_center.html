<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js" type="text/javascript"></script>
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='main.css') }}">
<style>
td {
  border-right: 1px solid #dddddd;
}
</style>
</head>

<body>
  
    <div class="topnav">
      <a style="float:left"  href="#home">Home</a>
      {% if current_user.is_authenticated %}
      <a style="float:right"  href="{{url_for('logout')}}">Logout</a>
      {% else %}
      <a style="float:right"  href="{{url_for('user_login')}}">Login</a>
      {% endif %}  
    </div>

<div class="center">
  <h1>Smart Room Control:</h1>
  <div>
  <table class="content-section-table">
    <tr>
    <th>
    {% if user.switch_status == 'off' %}     
    <td><div class="content-section"><h2 style="background-color: white; color: black; width: 100%;">Bulb</h2></div></td>
        <td><div class="content-section">
            <img id="arrowRotate" src="/static/web_pic/bulb-off.jpg" data-swap="/static/web_pic/bulb-on.jpg" data-src="/static/web_pic/bulb-on.jpg" width="40" height="40"/>
          </div>
          </td>
      <td style="border-right: none">
          <div class="content-section"> 
          <div class="onoffswitch" id="switch_fading">
            <input type="checkbox" name="onoffswitch" user_name="{{ user.username }}" class="onoffswitch-checkbox" id="myonoffswitch" tabindex="0">
            <label class="onoffswitch-label" for="myonoffswitch">
                <span class="onoffswitch-inner"></span>
                <span class="onoffswitch-switch"></span>
            </label>
        </div>      
      </div>
    </td>
    
    {% else %}

      <td><div class="content-section"><h2 style="background-color: white; color: black; width: 100%;">Bulb</h2></div></td>
      <td><div class="content-section">
        <img id="arrowRotate" src="/static/web_pic/bulb-on.jpg" data-swap="/static/web_pic/bulb-off.jpg" data-src="/static/web_pic/bulb-off.jpg" width="40" height="40"/>
      </div>
      </td>

    <td style="border-right: none;">
    <div class="content-section">  
        <div class="onoffswitch" id="switch_fading">
          <input type="checkbox" name="onoffswitch" user_name="{{ user.username }}" class="onoffswitch-checkbox" id="myonoffswitch" tabindex="0" checked>
          <label class="onoffswitch-label" for="myonoffswitch">
              <span class="onoffswitch-inner"></span>
              <span class="onoffswitch-switch"></span>
          </label>
      </div>  
    </div>
    </td>
    {% endif %}   
  </th>  
  </tr>
</table>
</div>

</div>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
  <script>

$('.onoffswitch-checkbox').on('click',function(){
        var username = $(this).attr('user_name')
        
        httpReq(username)       
       
  });

  function httpReq(username){

    req = $.ajax({
          url : '/update',
          type : 'POST',
          data : { username : username }
      });
     
      document.getElementById("myonoffswitch").disabled = true;
      $('#switch_fading').fadeTo("fast", 0.4);
            
      req.done(function(data){      
        if (data.sts =! "ok"){
          httpReq(username)
        }

        document.getElementById("myonoffswitch").disabled = false;
         $('#switch_fading').fadeTo("fast", 1);       
          //$('#updateStatus').text(data.status);  

        var swapImage = $('#arrowRotate').attr('data-swap'),
        currentImage = $('#arrowRotate').attr('src');
        $('#arrowRotate').attr({
          'src': swapImage,
          'data-swap': currentImage
         });         
                    
      });
  }
</script>

</body>
</html>
